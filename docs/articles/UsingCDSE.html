<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using 'Copernicus Data Space Ecosystem' API Wrapper • CDSE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using 'Copernicus Data Space Ecosystem' API Wrapper">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CDSE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/BeforeYouStart.html">Before you start</a></li>
    <li><a class="dropdown-item" href="../articles/UsingCDSE.html">Using 'Copernicus Data Space Ecosystem' API Wrapper</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/zivankaraman/CDSE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using 'Copernicus Data Space Ecosystem' API Wrapper</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/zivankaraman/CDSE/blob/HEAD/vignettes/UsingCDSE.Rmd" class="external-link"><code>vignettes/UsingCDSE.Rmd</code></a></small>
      <div class="d-none name"><code>UsingCDSE.Rmd</code></div>
    </div>

    
    
<div style="page-break-after: always;"></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>CDSE</code> package for R was developed to allow access to
the ‘<a href="https://dataspace.copernicus.eu/" class="external-link">Copernicus Data Space
Ecosystem</a>’ data and services from R. The
<code>'Copernicus Data Space Ecosystem'</code>, deployed in 2023, offers
access to the EO data collection from the Copernicus missions, with
discovery and download capabilities and numerous data processing tools.
In particular, the <a href="https://documentation.dataspace.copernicus.eu/APIs/SentinelHub.html" class="external-link">‘Sentinel
Hub’ API</a> provides access to the multi-spectral and multi-temporal
big data satellite imagery service, capable of fully automated,
real-time processing and distribution of remote sensing data and related
EO products. Users can use APIs to retrieve satellite data over their
AOI and specific time range from full archives in a matter of seconds.
When working on the application of EO where the area of interest is
relatively small compared to the image tiles distributed by Copernicus
(100 x 100 km), it allows to retrieve just the portion of the image of
interest rather than downloading the huge tile image file and processing
it locally. The goal of the <code>CDSE</code> package is to provide easy
access to this functionality from R.</p>
<p>The main functions allow to search the catalog of available imagery
from the Sentinel-1, Sentinel-2, Sentinel-3, and Sentinel-5 missions,
and to process and download the images of an area of interest and a time
range in various formats. Other functions might be added in subsequent
releases of the package.</p>
</div>
<div class="section level2">
<h2 id="api-authentication">API authentication<a class="anchor" aria-label="anchor" href="#api-authentication"></a>
</h2>
<p>Most of the API functions require OAuth2 authentication. The
recommended procedure is to obtain an authentication client object from
the <code>GetOAuthClient</code> function and pass it as the
<code>client</code> argument to the functions requiring the
authentication. For more detailed information, you are invited to
consult the “<code>Before you start</code>” document.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDSE_ID"</span><span class="op">)</span></span>
<span><span class="va">secret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDSE_SECRET"</span><span class="op">)</span></span>
<span><span class="va">OAuthClient</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetOAuthClient.html">GetOAuthClient</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">id</span>, secret <span class="op">=</span> <span class="va">secret</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="collections">Collections<a class="anchor" aria-label="anchor" href="#collections"></a>
</h2>
<p>We can get the list of all the imagery collections available in the
<code>'Copernicus Data Space Ecosystem'</code>. By default, the list is
formatted as a data.frame listing the main collection features. It is
also possible to obtain the raw list with all information by setting the
argument <code>as_data_frame</code> to <code>FALSE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetCollections.html">GetCollections</a></span><span class="op">(</span>as_data_frame <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">collections</span></span>
<span><span class="co">#&gt;                   id                title</span></span>
<span><span class="co">#&gt; 1     sentinel-2-l1c       Sentinel 2 L1C</span></span>
<span><span class="co">#&gt; 2 sentinel-3-olci-l2   Sentinel 3 OLCI L2</span></span>
<span><span class="co">#&gt; 3    sentinel-3-olci      Sentinel 3 OLCI</span></span>
<span><span class="co">#&gt; 4   sentinel-3-slstr     Sentinel 3 SLSTR</span></span>
<span><span class="co">#&gt; 5     sentinel-1-grd       Sentinel 1 GRD</span></span>
<span><span class="co">#&gt; 6     sentinel-2-l2a       Sentinel 2 L2A</span></span>
<span><span class="co">#&gt; 7     sentinel-5p-l2 Sentinel 5 Precursor</span></span>
<span><span class="co">#&gt;                                                    description</span></span>
<span><span class="co">#&gt; 1                     Sentinel 2 imagery processed to level 1C</span></span>
<span><span class="co">#&gt; 2 Sentinel 3 data derived from imagery captured by OLCI sensor</span></span>
<span><span class="co">#&gt; 3                   Sentinel 3 imagery captured by OLCI sensor</span></span>
<span><span class="co">#&gt; 4                  Sentinel 3 imagery captured by SLSTR sensor</span></span>
<span><span class="co">#&gt; 5                     Sentinel 1 Ground Range Detected Imagery</span></span>
<span><span class="co">#&gt; 6                     Sentinel 2 imagery processed to level 2A</span></span>
<span><span class="co">#&gt; 7      Sentinel 5 Precursor imagery captured by TROPOMI sensor</span></span>
<span><span class="co">#&gt;                  since instrument  gsd bands constellation long.min lat.min</span></span>
<span><span class="co">#&gt; 1 2015-11-01T00:00:00Z        msi   10    13    sentinel-2     -180     -56</span></span>
<span><span class="co">#&gt; 2 2016-04-17T11:33:13Z       olci  300    NA          &lt;NA&gt;     -180     -85</span></span>
<span><span class="co">#&gt; 3 2016-04-17T11:33:13Z       olci  300    21          &lt;NA&gt;     -180     -85</span></span>
<span><span class="co">#&gt; 4 2016-04-17T11:33:13Z      slstr 1000    11          &lt;NA&gt;     -180     -85</span></span>
<span><span class="co">#&gt; 5 2014-10-03T00:00:00Z      c-sar   NA    NA    sentinel-1     -180     -85</span></span>
<span><span class="co">#&gt; 6 2016-11-01T00:00:00Z        msi   10    12    sentinel-2     -180     -56</span></span>
<span><span class="co">#&gt; 7 2018-04-30T00:18:50Z    tropomi 5500    NA          &lt;NA&gt;     -180     -85</span></span>
<span><span class="co">#&gt;   long.max lat.max</span></span>
<span><span class="co">#&gt; 1      180      83</span></span>
<span><span class="co">#&gt; 2      180      85</span></span>
<span><span class="co">#&gt; 3      180      85</span></span>
<span><span class="co">#&gt; 4      180      85</span></span>
<span><span class="co">#&gt; 5      180      85</span></span>
<span><span class="co">#&gt; 6      180      83</span></span>
<span><span class="co">#&gt; 7      180      85</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
<div class="section level2">
<h2 id="catalog-search">Catalog search<a class="anchor" aria-label="anchor" href="#catalog-search"></a>
</h2>
<p>The imagery catalog can be searched by spatial and temporal extent
for every collection present in the
<code>'Copernicus Data Space Ecosystem'</code>. For the spatial filter,
you can provide either a <code>sf</code> or <code>sfc</code> object from
the <code>sf</code> package, typically a (multi)polygon, describing the
Area of Interest, or a numeric vector of four elements describing the
bounding box of interest. For the temporal filter, you must specify the
time range by either <code>Date</code> or <code>character</code> values
that can be converted to date by <code>as.Date</code> function. Open
intervals (one side only) can be obtained by providing the
<code>NA</code> or <code>NULL</code> value for the corresponding
argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"luxembourg.geojson"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">dsn</span>, as_tibble <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SearchCatalog.html">SearchCatalog</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, from <span class="op">=</span> <span class="st">"2023-07-01"</span>, to <span class="op">=</span> <span class="st">"2023-07-31"</span>, </span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, with_geometry <span class="op">=</span> <span class="cn">TRUE</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">images</span></span>
<span><span class="co">#&gt; Simple feature collection with 70 features and 11 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4.357925 ymin: 48.58836 xmax: 7.775117 ymax: 50.54532</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    acquisitionDate tileCloudCover areaCoverage   satellite</span></span>
<span><span class="co">#&gt; 1       2023-07-31          98.87     1.844514 sentinel-2a</span></span>
<span><span class="co">#&gt; 2       2023-07-31          99.85    20.345607 sentinel-2a</span></span>
<span><span class="co">#&gt; 3       2023-07-31          99.74     5.933960 sentinel-2a</span></span>
<span><span class="co">#&gt; 4       2023-07-31          99.94    16.323809 sentinel-2a</span></span>
<span><span class="co">#&gt; 5       2023-07-31          99.91    92.462651 sentinel-2a</span></span>
<span><span class="co">#&gt; 6       2023-07-31          99.41    22.236340 sentinel-2a</span></span>
<span><span class="co">#&gt; 7       2023-07-28          99.99     4.985657 sentinel-2a</span></span>
<span><span class="co">#&gt; 8       2023-07-28          99.99     5.658602 sentinel-2a</span></span>
<span><span class="co">#&gt; 9       2023-07-28          99.99     4.293632 sentinel-2a</span></span>
<span><span class="co">#&gt; 10      2023-07-28         100.00     6.854867 sentinel-2a</span></span>
<span><span class="co">#&gt;    acquisitionTimestampUTC acquisitionTimestampLocal</span></span>
<span><span class="co">#&gt; 1      2023-07-31 10:47:29       2023-07-31 12:47:29</span></span>
<span><span class="co">#&gt; 2      2023-07-31 10:47:25       2023-07-31 12:47:25</span></span>
<span><span class="co">#&gt; 3      2023-07-31 10:47:23       2023-07-31 12:47:23</span></span>
<span><span class="co">#&gt; 4      2023-07-31 10:47:14       2023-07-31 12:47:14</span></span>
<span><span class="co">#&gt; 5      2023-07-31 10:47:11       2023-07-31 12:47:11</span></span>
<span><span class="co">#&gt; 6      2023-07-31 10:47:09       2023-07-31 12:47:09</span></span>
<span><span class="co">#&gt; 7      2023-07-28 10:37:28       2023-07-28 12:37:28</span></span>
<span><span class="co">#&gt; 8      2023-07-28 10:37:27       2023-07-28 12:37:27</span></span>
<span><span class="co">#&gt; 9      2023-07-28 10:37:21       2023-07-28 12:37:21</span></span>
<span><span class="co">#&gt; 10     2023-07-28 10:37:20       2023-07-28 12:37:20</span></span>
<span><span class="co">#&gt;                                                             sourceId long.min</span></span>
<span><span class="co">#&gt; 1  S2A_MSIL2A_20230731T103631_N0509_R008_T31UFQ_20230731T202459.SAFE 4.357925</span></span>
<span><span class="co">#&gt; 2  S2A_MSIL2A_20230731T103631_N0509_R008_T31UGQ_20230731T202459.SAFE 5.714101</span></span>
<span><span class="co">#&gt; 3  S2A_MSIL2A_20230731T103631_N0509_R008_T32ULV_20230731T202459.SAFE 6.230946</span></span>
<span><span class="co">#&gt; 4  S2A_MSIL2A_20230731T103631_N0509_R008_T31UFR_20230731T202459.SAFE 4.382698</span></span>
<span><span class="co">#&gt; 5  S2A_MSIL2A_20230731T103631_N0509_R008_T31UGR_20230731T202459.SAFE 5.763559</span></span>
<span><span class="co">#&gt; 6  S2A_MSIL2A_20230731T103631_N0509_R008_T32ULA_20230731T202459.SAFE 6.178682</span></span>
<span><span class="co">#&gt; 7  S2A_MSIL2A_20230728T102601_N0509_R108_T31UGQ_20230728T180355.SAFE 5.880056</span></span>
<span><span class="co">#&gt; 8  S2A_MSIL2A_20230728T102601_N0509_R108_T32ULV_20230728T180355.SAFE 6.234494</span></span>
<span><span class="co">#&gt; 9  S2A_MSIL2A_20230728T102601_N0509_R108_T31UGQ_20230728T164605.SAFE 6.218396</span></span>
<span><span class="co">#&gt; 10 S2A_MSIL2A_20230728T102601_N0509_R108_T31UGR_20230728T180355.SAFE 6.219516</span></span>
<span><span class="co">#&gt;     lat.min long.max  lat.max                       geometry</span></span>
<span><span class="co">#&gt; 1  48.62983 5.904558 49.64443 POLYGON ((4.385187 49.64443...</span></span>
<span><span class="co">#&gt; 2  48.58836 7.285031 49.61960 POLYGON ((5.768528 49.6196,...</span></span>
<span><span class="co">#&gt; 3  48.63394 7.762836 49.64597 POLYGON ((6.230946 49.61959...</span></span>
<span><span class="co">#&gt; 4  49.52843 5.959371 50.54373 POLYGON ((4.411363 50.54373...</span></span>
<span><span class="co">#&gt; 5  49.48563 7.365728 50.51810 POLYGON ((5.820783 50.5181,...</span></span>
<span><span class="co">#&gt; 6  49.53174 7.752769 50.54532 POLYGON ((6.178682 50.51809...</span></span>
<span><span class="co">#&gt; 7  48.58836 7.281682 49.60696 POLYGON ((6.254039 49.60696...</span></span>
<span><span class="co">#&gt; 8  48.63304 7.775117 49.62896 POLYGON ((6.259211 49.62026...</span></span>
<span><span class="co">#&gt; 9  49.36204 7.285031 49.60696 POLYGON ((6.254038 49.60696...</span></span>
<span><span class="co">#&gt; 10 49.48568 7.279271 49.67956 POLYGON ((7.27598 49.48568,...</span></span></code></pre></div>
<p>We can visualize the coverage of the area of interest by the
satellite image tiles by plotting the footprints of the available images
and showing the region of interest in red.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span></span>
<span><span class="va">days</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">images</span><span class="op">$</span><span class="va">acquisitionDate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span>database <span class="op">=</span> <span class="st">"world"</span>, col <span class="op">=</span> <span class="st">"lightgrey"</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">9</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">47.5</span>, <span class="fl">51.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, border <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">images</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"AOI coverage by image tiles for period %s"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">days</span>, collapse <span class="op">=</span> <span class="st">" / "</span><span class="op">)</span><span class="op">)</span>, line <span class="op">=</span> <span class="fl">1L</span>, cex.main <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="UsingCDSE_files/figure-html/plot%20AOI%20coverage-1.png" alt="Luxembourg image tiles coverage" width="100%"><p class="caption">
Luxembourg image tiles coverage
</p>
</div>
<p>Some tiles cover only a small fraction of the area of interest, while
others cover almost the entire area.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">images</span><span class="op">$</span><span class="va">areaCoverage</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   1.845   5.603  15.113  19.758  20.346  92.463</span></span></code></pre></div>
<p>The tile number can be obtained from the image attribute
<code>sourceId</code>, as explained <a href="https://sentiwiki.copernicus.eu/web/s2-products" class="external-link">here</a>. We can
therefore summarize the distribution of area coverage by tile number,
and see which tiles provide the best coverage of the AOI.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tileNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">images</span><span class="op">$</span><span class="va">sourceId</span>, <span class="fl">39</span>, <span class="fl">44</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">images</span><span class="op">$</span><span class="va">areaCoverage</span>, INDICES <span class="op">=</span> <span class="va">tileNumber</span>, FUN <span class="op">=</span> <span class="va">summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; tileNumber: T31UFQ</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   1.845   1.845   1.845   1.845   1.845   1.845 </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; tileNumber: T31UFR</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   16.32   16.32   16.32   16.32   16.32   16.32 </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; tileNumber: T31UGQ</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   4.294   4.909  12.705  12.586  20.346  20.346 </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; tileNumber: T31UGR</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   6.855  15.608  54.299  53.426  92.463  92.463 </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; tileNumber: T32ULA</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   6.169  14.951  18.815  17.972  22.236  22.236 </span></span>
<span><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span><span class="co">#&gt; tileNumber: T32ULV</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   4.944   5.603   5.820   5.723   5.934   5.934</span></span></code></pre></div>
<div class="section level3">
<h3 id="catalog-by-season">Catalog by season<a class="anchor" aria-label="anchor" href="#catalog-by-season"></a>
</h3>
<p>Sometimes one can be interested in only a given period of each year,
for example, the images taken during the summer months (June to August).
We can filter an existing image catalog <em>a posteriori</em> using the
<code>SeasonalFilter</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"centralpark.geojson"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">dsn</span>, as_tibble <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SearchCatalog.html">SearchCatalog</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, from <span class="op">=</span> <span class="st">"2021-01-01"</span>, to <span class="op">=</span> <span class="st">"2023-12-31"</span>, </span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, with_geometry <span class="op">=</span> <span class="cn">FALSE</span>, filter <span class="op">=</span> <span class="st">"eo:cloud_cover &lt; 5"</span>, </span>
<span>    client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">images</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 77 10</span></span>
<span><span class="va">summer_images</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SeasonalFilter.html">SeasonalFilter</a></span><span class="op">(</span><span class="va">images</span>, from <span class="op">=</span> <span class="st">"2021-06-01"</span>, to <span class="op">=</span> <span class="st">"2023-08-31"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">summer_images</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 14 10</span></span></code></pre></div>
<p>It is also possible to query the API directly on the desired seasonal
periods by using a vectorized version of the <code>SearchCatalog</code>
function. The vectorized versions allow running a series of queries
having the same parameter values except for either time range, AOI, or
the bounding box parameters, using <code>lapply</code> or similar
function, and thus potentially also using the parallel processing.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"centralpark.geojson"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">dsn</span>, as_tibble <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SeasonalTimerange.html">SeasonalTimerange</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2021-06-01"</span>, to <span class="op">=</span> <span class="st">"2023-08-31"</span><span class="op">)</span></span>
<span><span class="va">lst_summer_images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">seasons</span>, <span class="va">SearchCatalogByTimerange</span>, aoi <span class="op">=</span> <span class="va">aoi</span>, </span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, filter <span class="op">=</span> <span class="st">"eo:cloud_cover &lt; 5"</span>, with_geometry <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>    client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">summer_images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">lst_summer_images</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">summer_images</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 14 10</span></span>
<span><span class="va">summer_images</span> <span class="op">&lt;-</span> <span class="va">summer_images</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">summer_images</span><span class="op">$</span><span class="va">acquisitionDate</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">summer_images</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">summer_images</span></span>
<span><span class="co">#&gt;    acquisitionDate tileCloudCover   satellite acquisitionTimestampUTC</span></span>
<span><span class="co">#&gt; 1       2023-08-20           0.03 sentinel-2a     2023-08-20 15:51:57</span></span>
<span><span class="co">#&gt; 2       2023-07-31           3.96 sentinel-2a     2023-07-31 15:51:56</span></span>
<span><span class="co">#&gt; 3       2023-07-26           0.89 sentinel-2b     2023-07-26 15:51:56</span></span>
<span><span class="co">#&gt; 4       2023-07-11           4.49 sentinel-2a     2023-07-11 15:51:56</span></span>
<span><span class="co">#&gt; 5       2023-06-01           0.00 sentinel-2a     2023-06-01 15:51:54</span></span>
<span><span class="co">#&gt; 6       2022-08-25           1.69 sentinel-2a     2022-08-25 15:52:03</span></span>
<span><span class="co">#&gt; 7       2022-08-03           4.58 sentinel-2b     2022-08-03 16:01:51</span></span>
<span><span class="co">#&gt; 8       2022-07-19           1.37 sentinel-2a     2022-07-19 16:01:58</span></span>
<span><span class="co">#&gt; 9       2022-07-11           4.89 sentinel-2b     2022-07-11 15:51:57</span></span>
<span><span class="co">#&gt; 10      2022-06-19           1.91 sentinel-2a     2022-06-19 16:01:58</span></span>
<span><span class="co">#&gt; 11      2022-06-06           1.00 sentinel-2a     2022-06-06 15:51:58</span></span>
<span><span class="co">#&gt; 12      2022-06-04           2.76 sentinel-2b     2022-06-04 16:01:47</span></span>
<span><span class="co">#&gt; 13      2021-06-16           4.74 sentinel-2b     2021-06-16 15:51:51</span></span>
<span><span class="co">#&gt; 14      2021-06-06           0.38 sentinel-2b     2021-06-06 15:51:52</span></span>
<span><span class="co">#&gt;    acquisitionTimestampLocal</span></span>
<span><span class="co">#&gt; 1        2023-08-20 11:51:57</span></span>
<span><span class="co">#&gt; 2        2023-07-31 11:51:56</span></span>
<span><span class="co">#&gt; 3        2023-07-26 11:51:56</span></span>
<span><span class="co">#&gt; 4        2023-07-11 11:51:56</span></span>
<span><span class="co">#&gt; 5        2023-06-01 11:51:54</span></span>
<span><span class="co">#&gt; 6        2022-08-25 11:52:03</span></span>
<span><span class="co">#&gt; 7        2022-08-03 12:01:51</span></span>
<span><span class="co">#&gt; 8        2022-07-19 12:01:58</span></span>
<span><span class="co">#&gt; 9        2022-07-11 11:51:57</span></span>
<span><span class="co">#&gt; 10       2022-06-19 12:01:58</span></span>
<span><span class="co">#&gt; 11       2022-06-06 11:51:58</span></span>
<span><span class="co">#&gt; 12       2022-06-04 12:01:47</span></span>
<span><span class="co">#&gt; 13       2021-06-16 11:51:51</span></span>
<span><span class="co">#&gt; 14       2021-06-06 11:51:52</span></span>
<span><span class="co">#&gt;                                                             sourceId  long.min</span></span>
<span><span class="co">#&gt; 1  S2A_MSIL2A_20230820T153821_N0509_R011_T18TWL_20230820T221958.SAFE -74.89340</span></span>
<span><span class="co">#&gt; 2  S2A_MSIL2A_20230731T155141_N0509_R011_T18TWL_20230731T220001.SAFE -74.88632</span></span>
<span><span class="co">#&gt; 3  S2B_MSIL2A_20230726T153819_N0509_R011_T18TWL_20230726T175732.SAFE -74.88431</span></span>
<span><span class="co">#&gt; 4  S2A_MSIL2A_20230711T153821_N0509_R011_T18TWL_20230711T233752.SAFE -74.88773</span></span>
<span><span class="co">#&gt; 5  S2A_MSIL2A_20230601T155141_N0509_R011_T18TWL_20230601T220554.SAFE -74.89199</span></span>
<span><span class="co">#&gt; 6  S2A_MSIL2A_20220825T155151_N0400_R011_T18TWL_20220825T220800.SAFE -74.89577</span></span>
<span><span class="co">#&gt; 7  S2B_MSIL2A_20220803T154819_N0400_R054_T18TWL_20220804T065759.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 8  S2A_MSIL2A_20220719T154951_N0400_R054_T18TWL_20220719T234155.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 9  S2B_MSIL2A_20220711T153819_N0400_R011_T18TWL_20220711T182252.SAFE -74.88525</span></span>
<span><span class="co">#&gt; 10 S2A_MSIL2A_20220619T154821_N0400_R054_T18TWL_20220619T232314.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 11 S2A_MSIL2A_20220606T153821_N0400_R011_T18TWL_20220606T230911.SAFE -74.88136</span></span>
<span><span class="co">#&gt; 12 S2B_MSIL2A_20220604T154809_N0400_R054_T18TWL_20220604T201432.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 13 S2B_MSIL2A_20210616T153809_N0500_R011_T18TWL_20230131T171455.SAFE -74.88136</span></span>
<span><span class="co">#&gt; 14 S2B_MSIL2A_20210606T153809_N0500_R011_T18TWL_20230603T225907.SAFE -74.88277</span></span>
<span><span class="co">#&gt;     lat.min  long.max  lat.max</span></span>
<span><span class="co">#&gt; 1  40.55548 -73.68381 41.55110</span></span>
<span><span class="co">#&gt; 2  40.55548 -73.68381 41.55107</span></span>
<span><span class="co">#&gt; 3  40.55548 -73.68381 41.55107</span></span>
<span><span class="co">#&gt; 4  40.55548 -73.68381 41.55108</span></span>
<span><span class="co">#&gt; 5  40.55548 -73.68381 41.55109</span></span>
<span><span class="co">#&gt; 6  40.55548 -73.68381 41.55111</span></span>
<span><span class="co">#&gt; 7  40.55820 -73.68381 41.55184</span></span>
<span><span class="co">#&gt; 8  40.55819 -73.68381 41.55184</span></span>
<span><span class="co">#&gt; 9  40.55550 -73.69200 41.35177</span></span>
<span><span class="co">#&gt; 10 40.55681 -73.68381 41.55184</span></span>
<span><span class="co">#&gt; 11 40.55548 -73.68381 41.55105</span></span>
<span><span class="co">#&gt; 12 40.55781 -73.68381 41.55184</span></span>
<span><span class="co">#&gt; 13 40.55548 -73.68381 41.55106</span></span>
<span><span class="co">#&gt; 14 40.55548 -73.68381 41.55106</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="section level2">
<h2 id="scripts">Scripts<a class="anchor" aria-label="anchor" href="#scripts"></a>
</h2>
<p>As we shall see in the examples below, we have to provide a
<code>script</code> argument to the <code>GetArchiveImage</code>
function.</p>
<p>An evalscript (or “custom script”) is a piece of JavaScript code that
defines how the satellite data shall be processed by the API and what
values the service shall return. It is a required part of any request
involving data processing, such as retrieving an image of the area of
interest.</p>
<p>The evaluation scripts can use any JavaScript function or language
structures, along with certain utility functions provided by the API for
user convenience. Chrome V8 JavaScript engine is used for running the
evalscripts.</p>
<p>The evaluation scripts are passed as the <code>script</code> argument
to the <code>GetArchiveImage</code> function. It has to be either a
character string containing the evaluation script or the name of the
file containing the script. The <code>scripts</code> folder of this
package contains a few examples of evaluation scripts.</p>
<p>It is beyond the scope of this document to provide guidance for
writing scripts, we encourage users to consult the API <a href="https://docs.sentinel-hub.com/api/latest/user-guides/beginners-guide/" class="external-link">Beginners
Guide</a> and <a href="https://docs.sentinel-hub.com/api/latest/evalscript/" class="external-link">Evalscript
(custom script)</a> documentation. You can find a big collection of
custom scripts that you can readily use in this <a href="https://custom-scripts.sentinel-hub.com/" class="external-link">repository</a>.</p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level2">
<h2 id="retrieving-images">Retrieving images<a class="anchor" aria-label="anchor" href="#retrieving-images"></a>
</h2>
<div class="section level3">
<h3 id="retrieving-aoi-satellite-image-as-a-raster-object">Retrieving AOI satellite image as a raster object<a class="anchor" aria-label="anchor" href="#retrieving-aoi-satellite-image-as-a-raster-object"></a>
</h3>
<p>One of the most important features of the API is its ability to
extract only the part of the images covering the area of interest. If
the AOI is small as in the example below, this is a significant gain in
efficiency (download, local processing) compared to getting the whole
tile image and processing it locally.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"centralpark.geojson"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">dsn</span>, as_tibble <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SearchCatalog.html">SearchCatalog</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, from <span class="op">=</span> <span class="st">"2021-05-01"</span>, to <span class="op">=</span> <span class="st">"2021-05-31"</span>, </span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, with_geometry <span class="op">=</span> <span class="cn">TRUE</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">images</span></span>
<span><span class="co">#&gt; Simple feature collection with 12 features and 11 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -75.00023 ymin: 40.55548 xmax: -73.68381 ymax: 41.55184</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    acquisitionDate tileCloudCover areaCoverage   satellite</span></span>
<span><span class="co">#&gt; 1       2021-05-30         100.00          100 sentinel-2b</span></span>
<span><span class="co">#&gt; 2       2021-05-27          16.26          100 sentinel-2b</span></span>
<span><span class="co">#&gt; 3       2021-05-25          26.47          100 sentinel-2a</span></span>
<span><span class="co">#&gt; 4       2021-05-22         100.00          100 sentinel-2a</span></span>
<span><span class="co">#&gt; 5       2021-05-20          24.31          100 sentinel-2b</span></span>
<span><span class="co">#&gt; 6       2021-05-17           7.17          100 sentinel-2b</span></span>
<span><span class="co">#&gt; 7       2021-05-15          28.17          100 sentinel-2a</span></span>
<span><span class="co">#&gt; 8       2021-05-12           1.35          100 sentinel-2a</span></span>
<span><span class="co">#&gt; 9       2021-05-10          92.67          100 sentinel-2b</span></span>
<span><span class="co">#&gt; 10      2021-05-07          89.62          100 sentinel-2b</span></span>
<span><span class="co">#&gt;    acquisitionTimestampUTC acquisitionTimestampLocal</span></span>
<span><span class="co">#&gt; 1      2021-05-30 16:01:47       2021-05-30 12:01:47</span></span>
<span><span class="co">#&gt; 2      2021-05-27 15:51:51       2021-05-27 11:51:51</span></span>
<span><span class="co">#&gt; 3      2021-05-25 16:01:47       2021-05-25 12:01:47</span></span>
<span><span class="co">#&gt; 4      2021-05-22 15:51:51       2021-05-22 11:51:51</span></span>
<span><span class="co">#&gt; 5      2021-05-20 16:01:47       2021-05-20 12:01:47</span></span>
<span><span class="co">#&gt; 6      2021-05-17 15:51:50       2021-05-17 11:51:50</span></span>
<span><span class="co">#&gt; 7      2021-05-15 16:01:47       2021-05-15 12:01:47</span></span>
<span><span class="co">#&gt; 8      2021-05-12 15:51:50       2021-05-12 11:51:50</span></span>
<span><span class="co">#&gt; 9      2021-05-10 16:01:45       2021-05-10 12:01:45</span></span>
<span><span class="co">#&gt; 10     2021-05-07 15:51:48       2021-05-07 11:51:48</span></span>
<span><span class="co">#&gt;                                                             sourceId  long.min</span></span>
<span><span class="co">#&gt; 1  S2B_MSIL2A_20210530T154809_N0500_R054_T18TWL_20230219T165456.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 2  S2B_MSIL2A_20210527T153809_N0500_R011_T18TWL_20230603T173050.SAFE -74.88348</span></span>
<span><span class="co">#&gt; 3  S2A_MSIL2A_20210525T154911_N0500_R054_T18TWL_20230208T124728.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 4  S2A_MSIL2A_20210522T153911_N0500_R011_T18TWL_20230604T065046.SAFE -74.87781</span></span>
<span><span class="co">#&gt; 5  S2B_MSIL2A_20210520T154809_N0500_R054_T18TWL_20230219T225246.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 6  S2B_MSIL2A_20210517T153809_N0500_R011_T18TWL_20230603T145938.SAFE -74.88206</span></span>
<span><span class="co">#&gt; 7  S2A_MSIL2A_20210515T154911_N0500_R054_T18TWL_20230206T101926.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 8  S2A_MSIL2A_20210512T153911_N0500_R011_T18TWL_20230604T080336.SAFE -74.87710</span></span>
<span><span class="co">#&gt; 9  S2B_MSIL2A_20210510T154809_N0500_R054_T18TWL_20230208T070834.SAFE -75.00023</span></span>
<span><span class="co">#&gt; 10 S2B_MSIL2A_20210507T153809_N0500_R011_T18TWL_20230604T114048.SAFE -74.87639</span></span>
<span><span class="co">#&gt;     lat.min  long.max  lat.max                       geometry</span></span>
<span><span class="co">#&gt; 1  40.55822 -73.68381 41.55184 POLYGON ((-75.00023 41.5518...</span></span>
<span><span class="co">#&gt; 2  40.55548 -73.68381 41.55106 POLYGON ((-74.57884 41.5510...</span></span>
<span><span class="co">#&gt; 3  40.55811 -73.68381 41.55184 POLYGON ((-75.00023 41.5518...</span></span>
<span><span class="co">#&gt; 4  40.55548 -73.68381 41.55104 POLYGON ((-74.57309 41.5510...</span></span>
<span><span class="co">#&gt; 5  40.55775 -73.68381 41.55184 POLYGON ((-75.00023 41.5518...</span></span>
<span><span class="co">#&gt; 6  40.55548 -73.68381 41.55106 POLYGON ((-74.57668 41.5510...</span></span>
<span><span class="co">#&gt; 7  40.55775 -73.68381 41.55184 POLYGON ((-75.00023 41.5518...</span></span>
<span><span class="co">#&gt; 8  40.55548 -73.68381 41.55104 POLYGON ((-74.57165 41.5510...</span></span>
<span><span class="co">#&gt; 9  40.55815 -73.68381 41.55184 POLYGON ((-75.00023 41.5518...</span></span>
<span><span class="co">#&gt; 10 40.55548 -73.68381 41.55103 POLYGON ((-74.57021 41.5510...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">images</span><span class="op">$</span><span class="va">areaCoverage</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;     100     100     100     100     100     100</span></span></code></pre></div>
<p>As the area is small, it is systematically fully covered by all
available images. We shall select the date with the least cloud cover,
and retrieve the NDVI values as a <code>SpatRaster</code> from package
<code>terra</code>. This allows further processing of the data, as shown
below by replacing all negative values with zero. The size of the pixels
is specified directly by the <code>resolution</code> argument. We are
also adding a 100-meter <code>buffer</code> around the area of interest
and <code>mask</code>ing the pixels outside of the AOI.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">day</span> <span class="op">&lt;-</span> <span class="va">images</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">images</span><span class="op">$</span><span class="va">tileCloudCover</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">acquisitionDate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">script_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"scripts"</span>, <span class="st">"NDVI_float32.js"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">ras</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetImage.html">GetImage</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, time_range <span class="op">=</span> <span class="va">day</span>, script <span class="op">=</span> <span class="va">script_file</span>, </span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, format <span class="op">=</span> <span class="st">"image/tiff"</span>, mosaicking_order <span class="op">=</span> <span class="st">"leastCC"</span>, </span>
<span>    resolution <span class="op">=</span> <span class="fl">10</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, buffer <span class="op">=</span> <span class="fl">100</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">ras</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 383, 355, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.0001003292, 0.0001003292  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -73.98355, -73.94794, 40.76322, 40.80165  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; name        : file96915665155f </span></span>
<span><span class="co">#&gt; min value   :       -0.5069648 </span></span>
<span><span class="co">#&gt; max value   :        0.9507549</span></span>
<span><span class="va">ras</span><span class="op">[</span><span class="va">ras</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ras</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Central Park NDVI on"</span>, <span class="va">day</span><span class="op">)</span>, cex.main <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkred"</span>, <span class="st">"yellow"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">99</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="UsingCDSE_files/figure-html/retrieve%20the%20NDVI%20image-1.png" alt="Central Park NDVI raster" width="100%"><p class="caption">
Central Park NDVI raster
</p>
</div>
</div>
<div class="section level3">
<h3 id="retrieving-aoi-satellite-image-as-an-image-file">Retrieving AOI satellite image as an image file<a class="anchor" aria-label="anchor" href="#retrieving-aoi-satellite-image-as-an-image-file"></a>
</h3>
<p>If we don’t want to process the satellite image locally but simply
use it as an image file (to include in a report or a Web page, for
example), we can use the appropriate script that will render a
three-band raster for RGB layers (or one for black-and-white image).
Here we specify the area of interest by its bounding box instead of the
exact geometry. We also demonstrate that the evaluation script can be
passed as a single character string, and provide the number of pixels in
the output image rather than the size of individual pixels - it makes
more sense if the image is intended for display and not processing.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">script_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"scripts"</span>, <span class="st">"TrueColorS2L2A.js"</span>, </span>
<span>    package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"scripts"</span>, <span class="st">"TrueColorS2L2A.js"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, </span>
<span>    <span class="st">"..."</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; //VERSION=3</span></span>
<span><span class="co">#&gt; //Optimized Sentinel-2 L2A True Color</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; function setup() {</span></span>
<span><span class="co">#&gt;   return {</span></span>
<span><span class="co">#&gt;     input: ["B04", "B03", "B02", "dataMask"],</span></span>
<span><span class="co">#&gt;     output: { bands: 4 }</span></span>
<span><span class="co">#&gt;   };</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; function evaluatePixel(smp) {</span></span>
<span><span class="co">#&gt;   const rgbLin = satEnh(sAdj(smp.B04), sAdj(smp.B03), sAdj(smp.B02));</span></span>
<span><span class="co">#&gt;   return [sRGB(rgbLin[0]), sRGB(rgbLin[1]), sRGB(rgbLin[2]), smp.dataMask];</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ...</span></span>
<span><span class="va">png</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"img"</span>, fileext <span class="op">=</span> <span class="st">".png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/GetImage.html">GetImage</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, time_range <span class="op">=</span> <span class="va">day</span>, script <span class="op">=</span> <span class="va">script_text</span>, </span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, file <span class="op">=</span> <span class="va">png</span>, format <span class="op">=</span> <span class="st">"image/png"</span>, </span>
<span>    mosaicking_order <span class="op">=</span> <span class="st">"leastCC"</span>, pixels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">600</span>, <span class="fl">950</span><span class="op">)</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">png</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="UsingCDSE_files/figure-html/retrieve%20RGB%20image-1.png" alt="Central Park image as PNG file" width="100%"><p class="caption">
Central Park image as PNG file
</p>
</div>
</div>
<div class="section level3">
<h3 id="retrieving-a-series-of-images-in-a-batch">Retrieving a series of images in a batch<a class="anchor" aria-label="anchor" href="#retrieving-a-series-of-images-in-a-batch"></a>
</h3>
<p>It often happens that one is interested in acquiring a series of
images of a particular zone (AOI or bounding box) for several dates, or
the images of different areas of interest for the same date (probably
located close to each other so that they are visited on the same day).
The <code>GetImageBy*</code> functions
(<code>GetImageByTimerange</code>, <code>GetImageByAOI</code>,
<code>GetImageByBbox</code>) facilitate this task as they are
specifically crafted for being called from a <code>lapply</code>-like
function, and thus potentially be executed in parallel. We shall
illustrate how to do this with an example.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"centralpark.geojson"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">dsn</span>, as_tibble <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">cloudless_images</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SearchCatalog.html">SearchCatalog</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, from <span class="op">=</span> <span class="st">"2023-01-01"</span>, to <span class="op">=</span> <span class="st">"2023-12-31"</span>,</span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, with_geometry <span class="op">=</span> <span class="cn">TRUE</span>, filter <span class="op">=</span> <span class="st">"eo:cloud_cover &lt; 0.8"</span>, </span>
<span>    client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">script_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"scripts"</span>, <span class="st">"NDVI_float32.js"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">days</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">cloudless_images</span><span class="op">$</span><span class="va">acquisitionDate</span><span class="op">)</span></span>
<span><span class="va">tmp_folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"dir"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">tmp_folder</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tmp_folder</span><span class="op">)</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span><span class="va">cl</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"tmp_folder"</span><span class="op">)</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterEvalQ</a></span><span class="op">(</span><span class="va">cl</span>, <span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zivankaraman.github.io/CDSE/">CDSE</a></span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">lstRast</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parLapply</a></span><span class="op">(</span><span class="va">cl</span>, <span class="va">days</span>, fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/GetImageBy....html">GetImageByTimerange</a></span><span class="op">(</span><span class="va">x</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/img_%s.tiff"</span>, <span class="va">tmp_folder</span>, <span class="va">x</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span><span class="op">}</span>,</span>
<span>    aoi <span class="op">=</span> <span class="va">aoi</span>, collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, script <span class="op">=</span> <span class="va">script_file</span>,</span>
<span>    format <span class="op">=</span> <span class="st">"image/tiff"</span>, mosaicking_order <span class="op">=</span> <span class="st">"mostRecent"</span>, resolution <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    buffer <span class="op">=</span> <span class="fl">0</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">days</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ras</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">lstRast</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">day</span> <span class="op">&lt;-</span> <span class="va">days</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">ras</span><span class="op">[</span><span class="va">ras</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ras</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Central Park NDVI on"</span>, <span class="va">day</span><span class="op">)</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>        cex.main <span class="op">=</span> <span class="fl">0.7</span>, pax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex.axis <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, plg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkred"</span>, <span class="st">"yellow"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">99</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="UsingCDSE_files/figure-html/retrieve%20images%20in%20parallel-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>In this particular example, parallelization is not necessarily
beneficial as we are retrieving only 12 images, but for a large number
of images, it can significantly reduce the execution time.</p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="section level2">
<h2 id="retrieving-statistics">Retrieving statistics<a class="anchor" aria-label="anchor" href="#retrieving-statistics"></a>
</h2>
<p>If you are only interested in calculating the average value (or some
other statistic) of some index or just the raw band values, the <a href="https://documentation.dataspace.copernicus.eu/APIs/SentinelHub/Statistical.html" class="external-link">Statistical
API</a> enables you to get statistics calculated based on satellite
imagery without having to download images. You need to specify your area
of interest, time period, evalscript, and which statistical measures
should be calculated. The requested statistics are returned as a
<code>data.frame</code> or as a <code>list</code>.</p>
<div class="section level3">
<h3 id="statistical-evalscripts">Statistical evalscripts<a class="anchor" aria-label="anchor" href="#statistical-evalscripts"></a>
</h3>
<p>All general rules for building evalscripts apply. However, there are
some specifics when using evalscripts with the Statistical API:</p>
<ul>
<li><p>The <code>evaluatePixel()</code> function must, in addition to
other output, always return also <code>dataMask</code> output. This
output defines which pixels are excluded from calculations. For more
details and an example, see here.</p></li>
<li><p>The default value of <code>sampleType</code> is
<code>FLOAT32</code>.</p></li>
<li><p>The output.bands parameter in the <code>setup()</code> function
can be an array. This makes it possible to specify custom names for the
output bands and different output <code>dataMask</code> for different
outputs.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="retrieving-simple-statistics">Retrieving simple statistics<a class="anchor" aria-label="anchor" href="#retrieving-simple-statistics"></a>
</h3>
<p>Besides the time range, you have to specify the way you want the
values to be aggregated over time. For this you use the
<code>aggregation_period</code> argument, providing the number of days
over which the statistics are calculated. The default value is one,
producing the daily statistics. If the last interval in the given time
range isn’t divisible by the provided aggregation interval, you can skip
the last interval (default behavior), shorten the last interval so that
it ends at the end of the provided time range, or extend the last
interval over the end of the provided time range so that all intervals
are of equal duration. This is controlled by the value of the
<code>lastIntervalBehavior</code> argument.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"centralpark.geojson"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">dsn</span>, as_tibble <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">script_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"scripts"</span>, <span class="st">"NDVI_CLOUDS_STAT.js"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">daily_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetStatistics.html">GetStatistics</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, time_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-07-01"</span>, <span class="st">"2023-07-31"</span><span class="op">)</span>,</span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, script <span class="op">=</span> <span class="va">script_file</span>, mosaicking_order <span class="op">=</span> <span class="st">"leastCC"</span>,</span>
<span>    resolution <span class="op">=</span> <span class="fl">100</span>, aggregation_period <span class="op">=</span> <span class="fl">1</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">weekly_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetStatistics.html">GetStatistics</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, time_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-07-01"</span>, <span class="st">"2023-07-31"</span><span class="op">)</span>,</span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, script <span class="op">=</span> <span class="va">script_file</span>,mosaicking_order <span class="op">=</span> <span class="st">"leastCC"</span>,</span>
<span>    resolution <span class="op">=</span> <span class="fl">100</span>, aggregation_period <span class="op">=</span> <span class="fl">7</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">weekly_stats_extended</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetStatistics.html">GetStatistics</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, </span>
<span>    time_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-07-01"</span>, <span class="st">"2023-07-31"</span><span class="op">)</span>, collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, </span>
<span>    script <span class="op">=</span> <span class="va">script_file</span>, mosaicking_order <span class="op">=</span> <span class="st">"leastCC"</span>, resolution <span class="op">=</span> <span class="fl">100</span>, </span>
<span>    aggregation_period <span class="op">=</span> <span class="fl">7</span>, lastIntervalBehavior <span class="op">=</span> <span class="st">"EXTEND"</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">daily_stats</span></span>
<span><span class="co">#&gt;          date     output        band min         mean          max        stDev</span></span>
<span><span class="co">#&gt; 1  2023-07-01 statistics  ndvi_value   0  0.210216716 6.509659e-01 1.700419e-01</span></span>
<span><span class="co">#&gt; 2  2023-07-01 statistics cloud_cover   0 21.028846154 5.900000e+01 1.413258e+01</span></span>
<span><span class="co">#&gt; 3  2023-07-04 statistics  ndvi_value   0  0.001150263 7.140577e-02 6.540354e-03</span></span>
<span><span class="co">#&gt; 4  2023-07-04 statistics cloud_cover  65 65.000000000 6.500000e+01 0.000000e+00</span></span>
<span><span class="co">#&gt; 5  2023-07-06 statistics  ndvi_value   0  0.590745587 9.372641e-01 3.130056e-01</span></span>
<span><span class="co">#&gt; 6  2023-07-06 statistics cloud_cover   0  0.040865385 1.000000e+00 1.979783e-01</span></span>
<span><span class="co">#&gt; 7  2023-07-09 statistics  ndvi_value   0  0.000207250 2.914758e-03 5.075671e-04</span></span>
<span><span class="co">#&gt; 8  2023-07-09 statistics cloud_cover  65 65.000000000 6.500000e+01 0.000000e+00</span></span>
<span><span class="co">#&gt; 9  2023-07-11 statistics  ndvi_value   0  0.581748619 9.156258e-01 3.050726e-01</span></span>
<span><span class="co">#&gt; 10 2023-07-11 statistics cloud_cover   0  0.031250000 1.000000e+00 1.739926e-01</span></span>
<span><span class="co">#&gt; 11 2023-07-14 statistics  ndvi_value   0  0.564096934 9.704262e-01 3.135816e-01</span></span>
<span><span class="co">#&gt; 12 2023-07-14 statistics cloud_cover   0  1.117788462 4.400000e+01 4.049344e+00</span></span>
<span><span class="co">#&gt; 13 2023-07-16 statistics  ndvi_value   0  0.011152588 3.966460e-02 5.850098e-03</span></span>
<span><span class="co">#&gt; 14 2023-07-16 statistics cloud_cover  65 73.283653846 1.000000e+02 1.457742e+01</span></span>
<span><span class="co">#&gt; 15 2023-07-19 statistics  ndvi_value   0  0.000000000 0.000000e+00 0.000000e+00</span></span>
<span><span class="co">#&gt; 16 2023-07-19 statistics cloud_cover  65 65.000000000 6.500000e+01 0.000000e+00</span></span>
<span><span class="co">#&gt; 17 2023-07-21 statistics  ndvi_value   0  0.341615600 8.719050e-01 2.366125e-01</span></span>
<span><span class="co">#&gt; 18 2023-07-21 statistics cloud_cover   0 18.954326923 1.000000e+02 2.746379e+01</span></span>
<span><span class="co">#&gt; 19 2023-07-24 statistics  ndvi_value   0  0.318054891 6.846920e-01 1.865030e-01</span></span>
<span><span class="co">#&gt; 20 2023-07-24 statistics cloud_cover   0  7.204326923 6.500000e+01 1.404899e+01</span></span>
<span><span class="co">#&gt; 21 2023-07-26 statistics  ndvi_value   0  0.549814982 8.600247e-01 2.815753e-01</span></span>
<span><span class="co">#&gt; 22 2023-07-26 statistics cloud_cover   0  0.040865385 1.000000e+00 1.979783e-01</span></span>
<span><span class="co">#&gt; 23 2023-07-29 statistics  ndvi_value   0  0.361753207 8.230490e-01 2.353884e-01</span></span>
<span><span class="co">#&gt; 24 2023-07-29 statistics cloud_cover   0 14.906250000 6.500000e+01 2.139831e+01</span></span>
<span><span class="co">#&gt; 25 2023-07-31 statistics  ndvi_value   0  0.574829539 9.039569e-01 2.998643e-01</span></span>
<span><span class="co">#&gt; 26 2023-07-31 statistics cloud_cover   0  0.024038462 1.000000e+00 1.531686e-01</span></span>
<span><span class="co">#&gt;    sampleCount noDataCount</span></span>
<span><span class="co">#&gt; 1         1120         704</span></span>
<span><span class="co">#&gt; 2         1120         704</span></span>
<span><span class="co">#&gt; 3         1120         704</span></span>
<span><span class="co">#&gt; 4         1120         704</span></span>
<span><span class="co">#&gt; 5         1120         704</span></span>
<span><span class="co">#&gt; 6         1120         704</span></span>
<span><span class="co">#&gt; 7         1120         704</span></span>
<span><span class="co">#&gt; 8         1120         704</span></span>
<span><span class="co">#&gt; 9         1120         704</span></span>
<span><span class="co">#&gt; 10        1120         704</span></span>
<span><span class="co">#&gt; 11        1120         704</span></span>
<span><span class="co">#&gt; 12        1120         704</span></span>
<span><span class="co">#&gt; 13        1120         704</span></span>
<span><span class="co">#&gt; 14        1120         704</span></span>
<span><span class="co">#&gt; 15        1120         704</span></span>
<span><span class="co">#&gt; 16        1120         704</span></span>
<span><span class="co">#&gt; 17        1120         704</span></span>
<span><span class="co">#&gt; 18        1120         704</span></span>
<span><span class="co">#&gt; 19        1120         704</span></span>
<span><span class="co">#&gt; 20        1120         704</span></span>
<span><span class="co">#&gt; 21        1120         704</span></span>
<span><span class="co">#&gt; 22        1120         704</span></span>
<span><span class="co">#&gt; 23        1120         704</span></span>
<span><span class="co">#&gt; 24        1120         704</span></span>
<span><span class="co">#&gt; 25        1120         704</span></span>
<span><span class="co">#&gt; 26        1120         704</span></span>
<span><span class="va">weekly_stats</span></span>
<span><span class="co">#&gt;         from         to     output        band min        mean         max</span></span>
<span><span class="co">#&gt; 1 2023-07-01 2023-07-07 statistics  ndvi_value   0  0.59074559   0.9372641</span></span>
<span><span class="co">#&gt; 2 2023-07-01 2023-07-07 statistics cloud_cover   0  0.04086538   1.0000000</span></span>
<span><span class="co">#&gt; 3 2023-07-08 2023-07-14 statistics  ndvi_value   0  0.58174862   0.9156258</span></span>
<span><span class="co">#&gt; 4 2023-07-08 2023-07-14 statistics cloud_cover   0  0.03125000   1.0000000</span></span>
<span><span class="co">#&gt; 5 2023-07-15 2023-07-21 statistics  ndvi_value   0  0.34161560   0.8719050</span></span>
<span><span class="co">#&gt; 6 2023-07-15 2023-07-21 statistics cloud_cover   0 18.95432692 100.0000000</span></span>
<span><span class="co">#&gt; 7 2023-07-22 2023-07-28 statistics  ndvi_value   0  0.54981498   0.8600247</span></span>
<span><span class="co">#&gt; 8 2023-07-22 2023-07-28 statistics cloud_cover   0  0.04086538   1.0000000</span></span>
<span><span class="co">#&gt;        stDev sampleCount noDataCount</span></span>
<span><span class="co">#&gt; 1  0.3130056        1120         704</span></span>
<span><span class="co">#&gt; 2  0.1979783        1120         704</span></span>
<span><span class="co">#&gt; 3  0.3050726        1120         704</span></span>
<span><span class="co">#&gt; 4  0.1739926        1120         704</span></span>
<span><span class="co">#&gt; 5  0.2366125        1120         704</span></span>
<span><span class="co">#&gt; 6 27.4637931        1120         704</span></span>
<span><span class="co">#&gt; 7  0.2815753        1120         704</span></span>
<span><span class="co">#&gt; 8  0.1979783        1120         704</span></span>
<span><span class="va">weekly_stats_extended</span></span>
<span><span class="co">#&gt;          from         to     output        band min        mean         max</span></span>
<span><span class="co">#&gt; 1  2023-07-01 2023-07-07 statistics  ndvi_value   0  0.59074559   0.9372641</span></span>
<span><span class="co">#&gt; 2  2023-07-01 2023-07-07 statistics cloud_cover   0  0.04086538   1.0000000</span></span>
<span><span class="co">#&gt; 3  2023-07-08 2023-07-14 statistics  ndvi_value   0  0.58174862   0.9156258</span></span>
<span><span class="co">#&gt; 4  2023-07-08 2023-07-14 statistics cloud_cover   0  0.03125000   1.0000000</span></span>
<span><span class="co">#&gt; 5  2023-07-15 2023-07-21 statistics  ndvi_value   0  0.34161560   0.8719050</span></span>
<span><span class="co">#&gt; 6  2023-07-15 2023-07-21 statistics cloud_cover   0 18.95432692 100.0000000</span></span>
<span><span class="co">#&gt; 7  2023-07-22 2023-07-28 statistics  ndvi_value   0  0.54981498   0.8600247</span></span>
<span><span class="co">#&gt; 8  2023-07-22 2023-07-28 statistics cloud_cover   0  0.04086538   1.0000000</span></span>
<span><span class="co">#&gt; 9  2023-07-29 2023-08-04 statistics  ndvi_value   0  0.57482954   0.9039569</span></span>
<span><span class="co">#&gt; 10 2023-07-29 2023-08-04 statistics cloud_cover   0  0.02403846   1.0000000</span></span>
<span><span class="co">#&gt;         stDev sampleCount noDataCount</span></span>
<span><span class="co">#&gt; 1   0.3130056        1120         704</span></span>
<span><span class="co">#&gt; 2   0.1979783        1120         704</span></span>
<span><span class="co">#&gt; 3   0.3050726        1120         704</span></span>
<span><span class="co">#&gt; 4   0.1739926        1120         704</span></span>
<span><span class="co">#&gt; 5   0.2366125        1120         704</span></span>
<span><span class="co">#&gt; 6  27.4637931        1120         704</span></span>
<span><span class="co">#&gt; 7   0.2815753        1120         704</span></span>
<span><span class="co">#&gt; 8   0.1979783        1120         704</span></span>
<span><span class="co">#&gt; 9   0.2998643        1120         704</span></span>
<span><span class="co">#&gt; 10  0.1531686        1120         704</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieving-statistics-with-percentiles">Retrieving statistics with percentiles<a class="anchor" aria-label="anchor" href="#retrieving-statistics-with-percentiles"></a>
</h3>
<p>Besides the basic statistics (min, max, mean, stDev), one can also
request to compute the percentiles. If the percentiles requested are 25,
50, and 75, the corresponding output is renamed ‘q1’, ‘median’, and
‘q3’.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetStatistics.html">GetStatistics</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, time_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-07-01"</span>, <span class="st">"2023-07-31"</span><span class="op">)</span>,</span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, script <span class="op">=</span> <span class="va">script_file</span>, mosaicking_order <span class="op">=</span> <span class="st">"leastCC"</span>,</span>
<span>    resolution <span class="op">=</span> <span class="fl">100</span>, aggregation_period <span class="op">=</span> <span class="fl">1</span>, percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span><span class="op">)</span>, </span>
<span>    client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">daily_stats</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;          date     output        band min          q1     median         mean</span></span>
<span><span class="co">#&gt; 1  2023-07-01 statistics  ndvi_value   0  0.06187625  0.1854656  0.210216716</span></span>
<span><span class="co">#&gt; 2  2023-07-01 statistics cloud_cover   0  9.00000000 20.0000000 21.028846154</span></span>
<span><span class="co">#&gt; 3  2023-07-04 statistics  ndvi_value   0  0.00000000  0.0000000  0.001150263</span></span>
<span><span class="co">#&gt; 4  2023-07-04 statistics cloud_cover  65 65.00000000 65.0000000 65.000000000</span></span>
<span><span class="co">#&gt; 5  2023-07-06 statistics  ndvi_value   0  0.39318886  0.7291402  0.590745587</span></span>
<span><span class="co">#&gt; 6  2023-07-06 statistics cloud_cover   0  0.00000000  0.0000000  0.040865385</span></span>
<span><span class="co">#&gt; 7  2023-07-09 statistics  ndvi_value   0  0.00000000  0.0000000  0.000207250</span></span>
<span><span class="co">#&gt; 8  2023-07-09 statistics cloud_cover  65 65.00000000 65.0000000 65.000000000</span></span>
<span><span class="co">#&gt; 9  2023-07-11 statistics  ndvi_value   0  0.38260868  0.7194318  0.581748619</span></span>
<span><span class="co">#&gt; 10 2023-07-11 statistics cloud_cover   0  0.00000000  0.0000000  0.031250000</span></span>
<span><span class="co">#&gt;            q3          max        stDev sampleCount noDataCount</span></span>
<span><span class="co">#&gt; 1   0.3439528  0.650965929 1.700419e-01        1120         704</span></span>
<span><span class="co">#&gt; 2  32.0000000 59.000000000 1.413258e+01        1120         704</span></span>
<span><span class="co">#&gt; 3   0.0000000  0.071405768 6.540354e-03        1120         704</span></span>
<span><span class="co">#&gt; 4  65.0000000 65.000000000 0.000000e+00        1120         704</span></span>
<span><span class="co">#&gt; 5   0.8292812  0.937264144 3.130056e-01        1120         704</span></span>
<span><span class="co">#&gt; 6   0.0000000  1.000000000 1.979783e-01        1120         704</span></span>
<span><span class="co">#&gt; 7   0.0000000  0.002914758 5.075671e-04        1120         704</span></span>
<span><span class="co">#&gt; 8  65.0000000 65.000000000 0.000000e+00        1120         704</span></span>
<span><span class="co">#&gt; 9   0.8155493  0.915625751 3.050726e-01        1120         704</span></span>
<span><span class="co">#&gt; 10  0.0000000  1.000000000 1.739926e-01        1120         704</span></span>
<span><span class="va">weekly_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetStatistics.html">GetStatistics</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, time_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-07-01"</span>, <span class="st">"2023-07-31"</span><span class="op">)</span>,</span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, script <span class="op">=</span> <span class="va">script_file</span>,mosaicking_order <span class="op">=</span> <span class="st">"leastCC"</span>,</span>
<span>    resolution <span class="op">=</span> <span class="fl">100</span>, aggregation_period <span class="op">=</span> <span class="fl">7</span>, percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, </span>
<span>    client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">weekly_stats</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         from         to     output        band min     P.10.0    P.20.0</span></span>
<span><span class="co">#&gt; 1 2023-07-01 2023-07-07 statistics  ndvi_value   0 0.00000000 0.2386117</span></span>
<span><span class="co">#&gt; 2 2023-07-01 2023-07-07 statistics cloud_cover   0 0.00000000 0.0000000</span></span>
<span><span class="co">#&gt; 3 2023-07-08 2023-07-14 statistics  ndvi_value   0 0.00000000 0.2473698</span></span>
<span><span class="co">#&gt; 4 2023-07-08 2023-07-14 statistics cloud_cover   0 0.00000000 0.0000000</span></span>
<span><span class="co">#&gt; 5 2023-07-15 2023-07-21 statistics  ndvi_value   0 0.03113456 0.1101370</span></span>
<span><span class="co">#&gt; 6 2023-07-15 2023-07-21 statistics cloud_cover   0 0.00000000 0.0000000</span></span>
<span><span class="co">#&gt; 7 2023-07-22 2023-07-28 statistics  ndvi_value   0 0.00000000 0.2345048</span></span>
<span><span class="co">#&gt; 8 2023-07-22 2023-07-28 statistics cloud_cover   0 0.00000000 0.0000000</span></span>
<span><span class="co">#&gt;      P.30.0    P.40.0    P.50.0        mean     P.60.0     P.70.0     P.80.0</span></span>
<span><span class="co">#&gt; 1 0.5270270 0.6485913 0.7291402  0.59074559  0.7688466  0.8111159  0.8490484</span></span>
<span><span class="co">#&gt; 2 0.0000000 0.0000000 0.0000000  0.04086538  0.0000000  0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; 3 0.5275056 0.6426682 0.7194318  0.58174862  0.7583096  0.7922882  0.8290598</span></span>
<span><span class="co">#&gt; 4 0.0000000 0.0000000 0.0000000  0.03125000  0.0000000  0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; 5 0.1839369 0.2453626 0.3146195  0.34161560  0.3871180  0.4729951  0.5737004</span></span>
<span><span class="co">#&gt; 6 0.0000000 2.0000000 4.0000000 18.95432692 10.0000000 23.0000000 35.0000000</span></span>
<span><span class="co">#&gt; 7 0.5171583 0.6132419 0.6799566  0.54981498  0.7185010  0.7427998  0.7737296</span></span>
<span><span class="co">#&gt; 8 0.0000000 0.0000000 0.0000000  0.04086538  0.0000000  0.0000000  0.0000000</span></span>
<span><span class="co">#&gt;       P.90.0         max      stDev sampleCount noDataCount</span></span>
<span><span class="co">#&gt; 1  0.8826502   0.9372641  0.3130056        1120         704</span></span>
<span><span class="co">#&gt; 2  0.0000000   1.0000000  0.1979783        1120         704</span></span>
<span><span class="co">#&gt; 3  0.8645161   0.9156258  0.3050726        1120         704</span></span>
<span><span class="co">#&gt; 4  0.0000000   1.0000000  0.1739926        1120         704</span></span>
<span><span class="co">#&gt; 5  0.6986371   0.8719050  0.2366125        1120         704</span></span>
<span><span class="co">#&gt; 6 62.0000000 100.0000000 27.4637931        1120         704</span></span>
<span><span class="co">#&gt; 7  0.8089786   0.8600247  0.2815753        1120         704</span></span>
<span><span class="co">#&gt; 8  0.0000000   1.0000000  0.1979783        1120         704</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieving-a-series-of-statistics-in-a-batch">Retrieving a series of statistics in a batch<a class="anchor" aria-label="anchor" href="#retrieving-a-series-of-statistics-in-a-batch"></a>
</h3>
<p>Just as when retrieving satellite images, one can be interested in
acquiring a series of statistics for a particular zone (AOI or bounding
box) for several dates, or the statistics of different zones for the
same periods. The <code>GetStatisticsBy*</code> functions
(<code>GetStatisticsByTimerange</code>, <code>GetStatisticsByAOI</code>,
<code>GetStatisticsByBbox</code>) facilitate this task as they are
specifically crafted for being called from a <code>lapply</code>-like
function, and thus potentially be executed in parallel. The following
example illustrates how to do this.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"centralpark.geojson"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">dsn</span>, as_tibble <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">script_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"scripts"</span>, <span class="st">"NDVI_dataMask_float32.js"</span>, package <span class="op">=</span> <span class="st">"CDSE"</span><span class="op">)</span></span>
<span><span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SeasonalTimerange.html">SeasonalTimerange</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2020-06-01"</span>, to <span class="op">=</span> <span class="st">"2023-08-31"</span><span class="op">)</span></span>
<span><span class="va">lst_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">seasons</span>, <span class="va">GetStatisticsByTimerange</span>, aoi <span class="op">=</span> <span class="va">aoi</span>, </span>
<span>    collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>, script <span class="op">=</span> <span class="va">script_file</span>, mosaicking_order <span class="op">=</span> <span class="st">"leastCC"</span>, </span>
<span>    resolution <span class="op">=</span> <span class="fl">100</span>, aggregation_period <span class="op">=</span> <span class="fl">7L</span>, client <span class="op">=</span> <span class="va">OAuthClient</span><span class="op">)</span></span>
<span><span class="va">weekly_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">lst_stats</span><span class="op">)</span></span>
<span><span class="va">weekly_stats</span> <span class="op">&lt;-</span> <span class="va">weekly_stats</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">weekly_stats</span><span class="op">$</span><span class="va">from</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">weekly_stats</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">weekly_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;         from         to     output       band min      mean       max     stDev</span></span>
<span><span class="co">#&gt; 1 2020-06-01 2020-06-07 statistics ndvi_value   0 0.5098300 0.8682218 0.2910484</span></span>
<span><span class="co">#&gt; 2 2020-06-08 2020-06-14 statistics ndvi_value   0 0.5726369 0.9431616 0.3054573</span></span>
<span><span class="co">#&gt; 3 2020-06-15 2020-06-21 statistics ndvi_value   0 0.6214251 1.0000000 0.3205804</span></span>
<span><span class="co">#&gt; 4 2020-06-22 2020-06-28 statistics ndvi_value   0 0.4591027 0.8495593 0.2735705</span></span>
<span><span class="co">#&gt; 5 2020-06-29 2020-07-05 statistics ndvi_value   0 0.5989513 0.9304222 0.3006899</span></span>
<span><span class="co">#&gt; 6 2020-07-06 2020-07-12 statistics ndvi_value   0 0.5813920 0.9333899 0.3058014</span></span>
<span><span class="co">#&gt;   sampleCount noDataCount</span></span>
<span><span class="co">#&gt; 1        1120         704</span></span>
<span><span class="co">#&gt; 2        1120         704</span></span>
<span><span class="co">#&gt; 3        1120         704</span></span>
<span><span class="co">#&gt; 4        1120         704</span></span>
<span><span class="co">#&gt; 5        1120         704</span></span>
<span><span class="co">#&gt; 6        1120         704</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="copernicus-data-space-ecosystem-services-status">Copernicus Data Space Ecosystem services status<a class="anchor" aria-label="anchor" href="#copernicus-data-space-ecosystem-services-status"></a>
</h2>
<p>If you encounter any connection issues while using this package,
please check your internet connection first. If your internet connection
is working fine, you can also check the status of the Copernicus Data
Space Ecosystem services by visiting <a href="https://dashboard.dataspace.copernicus.eu/#/service-health" class="external-link">this</a>
webpage. It provides a quasi real-time status of the various services
provided. Once you are on the webpage, scroll down to Sentinel Hub, and
pay particular attention to the Process API (used for retrieving
images), Catalog API (used for catalog searches), and Statistical API
(used for retrieving statistics).</p>
<p><a href="https://dashboard.dataspace.copernicus.eu/#/service-health" class="external-link"><img src="service_health.png" alt="Copernicus Data Space Ecosystem Service Health"></a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zivan Karaman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
